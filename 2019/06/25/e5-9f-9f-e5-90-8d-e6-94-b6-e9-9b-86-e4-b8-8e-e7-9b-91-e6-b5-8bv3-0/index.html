<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>域名收集与监测V3.0 | guimaizi&#39;s blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="guimaizi&#39;s blog" type="application/atom+xml">
    
<meta name="generator" content="Hexo 4.2.0"></head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/archives" class="header__link">Archive</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/atom.xml" class="header__link">RSS</a>
			
		</nav>
		<h1 class="header__title"><a href="/">guimaizi&#39;s blog</a></h1>
		<h2 class="header__subtitle">道心不改,灵台无尘。</h2>
	</header>

	<main>
		<article>
	
		<h1>域名收集与监测V3.0</h1>
	
	<div class="article__infos">
		<span class="article__date">2019-06-25</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/%E5%AE%89%E5%85%A8-%E4%BB%A3%E7%A0%81/">安全/代码</a>
			</span><br />
		
		
	</div>

	

	
		<p>github:<a href="https://github.com/guimaizi/get_domain" target="_blank" rel="noopener">https://github.com/guimaizi/get_domain</a></p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>在职业刷src或者apt攻击者的角度，单单过一遍爆破的域名是不能满足持续性漏洞挖掘;从职业刷src的角度，过一遍收集的子域名，已经发现了所有漏洞并已经提交后修复，或者用当前漏洞测试方法并没发现有漏洞，这样业务是安全的，但这个安全是在当下时间的，企业要发展、要解决当前问题，就会出新业务、或者不断的修复更新旧问题，这就是业务的变化，通过持续性监控子域名就会发现业务的变化，最快速度的发现变化，对变化进行安全测试、漏洞挖掘。有经验的刷src的同学都知道，新业务发现漏洞概率都很高。</p>
<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><p>需要环境: * win10/8/7/xp<br>其他请自行修改代码、反正是开源，改动也不大。 * python3<br>python3.5+ 自行官方下载 * mongodb<br>自行官方下载 建议docker搭建 参考:<a href="https://www.jianshu.com/p/6fdb2bcb4b43" target="_blank" rel="noopener">https://www.jianshu.com/p/6fdb2bcb4b43</a> * chrome<br>自行官方下载 * chromedriver<br>下载成功后放入python根目录或加入全局环境变量<br>chromedriver下载地址:<a href="http://npm.taobao.org/mirrors/chromedriver/" target="_blank" rel="noopener">http://npm.taobao.org/mirrors/chromedriver/</a> 注:与当前chrome匹配 * subfinder<br><a href="https://github.com/subfinder/subfinder" target="_blank" rel="noopener">https://github.com/subfinder/subfinder</a> win默认带有,其他请自行修改代码。 以上配置完成,切进项目目录<br>pip 安装requirements.txt</p>
<blockquote>
<p>pip install -r requirements.txt</p>
</blockquote>
<p>设置config.json</p>
<pre><code>{
    &quot;path&quot;:&quot;E:/code/test1&quot;, //项目所在绝对路径
    &quot;target_json&quot;:&quot;E:/code/test1/target/qq.json&quot;,   //目标域名文件绝对路径
    &quot;chrome_path&quot;:&quot;C:/Program Files (x86)/Google/Chrome/Application/chrome.exe&quot;, //chrome文件绝对路径
    &quot;timeout&quot;:8, //全局超时设置,建议大于5
    &quot;mongo_config&quot;:{&quot;ip&quot;:&quot;127.0.0.1&quot;,&quot;port&quot;:27017,&quot;name&quot;:&quot;&quot;,&quot;password&quot;:&quot;&quot;} //mongodb 配置,ip 端口 name passwrod  空密码时name pwd设置为空
}</code></pre><p>设置目标域名文件</p>
<pre><code>{
&quot;domain&quot;:&quot;.qq.com&quot;,  //目标域名 必须是.xx.xxx 如.qq.com .163.com .126.net
//子域名黑名单,解决泛解析问题
&quot;Blacklist_domain&quot;:[
        &quot;.qzone.qq.com&quot;,
        &quot;.gamebbs.qq.com&quot;,
        &quot;.ke.qq.com&quot;,
        &quot;.house.qq.com&quot;,
        &quot;.auto.qq.com&quot;,
        &quot;.openwebgame.qq.com&quot;,
        &quot;.house.qq.com&quot;,
        &quot;.zhan.qq.com&quot;,
        &quot;.114.qq.com&quot;,
        &quot;.photo.store.qq.com&quot;,
        &quot;.b.qq.com&quot;,
        &quot;.m.qq.com&quot;,
        &quot;.z.qq.com&quot;,
        &quot;.t.qq.com&quot;,
        &quot;.ly.qq.com&quot;,
        &quot;.zg.qq.com&quot;,
        &quot;.3g.qq.com&quot;,
        &quot;.4g.qq.com&quot;,
        &quot;.ia.qq.com&quot;,
        &quot;.city.qq.com&quot;,
        &quot;.photo.qq.com&quot;
    ]
}</code></pre><p>设置fun_all.py第12行</p>
<pre><code>修改对应config.json绝对路径</code></pre><h3 id="运行说明"><a href="#运行说明" class="headerlink" title="运行说明"></a>运行说明</h3><p>获取域名http响应结果写入mongodb库 <figure class="figure"><img src="https://raw.githubusercontent.com/guimaizi/cloud/test/20190614112043.png" alt=""></figure> 获取子域名、子域名管理、子域名监控</p>
<blockquote>
<p>python start.py [argv]<br>-s 开始通过subfinder爆破获取第一批域名;<br>-u 调出数据库内domain重新爬行，通过新旧返回值比对，发现业务变化;<br>-i 导入域名txt字典文件 格式为:xxx.xxx.com;<br>-iurl 导入url txt文件 格式为:<a href="http://xxx.xxx.com/dasd.php" target="_blank" rel="noopener">http://xxx.xxx.com/dasd.php</a>;</p>
</blockquote>
<p><figure class="figure"><img src="https://raw.githubusercontent.com/guimaizi/cloud/test/20190624222624.png" alt=""></figure></p>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p><figure class="figure"><img src="https://raw.githubusercontent.com/guimaizi/cloud/test/20190624222715.png" alt=""></figure></p>
<h3 id="码个代码不容易，希望有钱人打赏-万分感谢。"><a href="#码个代码不容易，希望有钱人打赏-万分感谢。" class="headerlink" title="码个代码不容易，希望有钱人打赏,万分感谢。"></a>码个代码不容易，希望有钱人打赏,万分感谢。</h3><p><figure class="figure"><img src="https://raw.githubusercontent.com/guimaizi/cloud/test/img/20190301182006.jpg" alt=""></figure></p>

	

	
		<span class="different-posts"><a href="/2019/06/25/e5-9f-9f-e5-90-8d-e6-94-b6-e9-9b-86-e4-b8-8e-e7-9b-91-e6-b5-8bv3-0/" onclick="window.history.go(-1); return false;">⬅️ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>Hi there, <br />welcome to my Blog glad you found it. Have a look around, will you?</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2020 guimaizi | Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo" target="_blank" rel="noopener">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
